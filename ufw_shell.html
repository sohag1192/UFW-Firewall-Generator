<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UFW Master Script Builder v2</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-body: #0d1117;
            --bg-card: #161b22;
            --border: #30363d;
            --accent: #238636;
            --accent-hover: #2ea043;
            --text-main: #c9d1d9;
            --text-muted: #8b949e;
            --input-bg: #0d1117;
            --danger: #da3633;
            --highlight: #1f6feb;
        }

        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 40px 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* CARD STYLES */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .header h1 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 700;
            color: #fff;
            letter-spacing: -0.5px;
        }
        .badge {
            background: var(--highlight);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 700;
        }

        /* MODE SWITCHER */
        .mode-switcher {
            display: flex;
            background: var(--input-bg);
            padding: 4px;
            border-radius: 8px;
            border: 1px solid var(--border);
            margin-bottom: 20px;
        }
        .mode-btn {
            flex: 1;
            padding: 8px;
            text-align: center;
            cursor: pointer;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-muted);
            transition: 0.2s;
        }
        .mode-btn.active {
            background: #30363d;
            color: #fff;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        /* FORM GRID */
        .grid-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        .full-width { grid-column: span 2; }

        label {
            display: block;
            margin-bottom: 6px;
            font-size: 0.85rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        input, select {
            width: 100%;
            background: var(--input-bg);
            border: 1px solid var(--border);
            color: var(--text-main);
            padding: 10px 12px;
            border-radius: 6px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            box-sizing: border-box;
        }
        input:focus, select:focus {
            outline: none;
            border-color: var(--highlight);
        }

        .hidden { display: none; }

        /* BUTTONS */
        .btn-group { display: flex; gap: 10px; }
        button {
            padding: 10px 16px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            border: 1px solid rgba(240, 246, 252, 0.1);
            font-size: 0.9rem;
        }
        .btn-primary { background: var(--accent); color: white; border: none; flex: 2; }
        .btn-primary:hover { background: var(--accent-hover); }
        .btn-secondary { background: #21262d; color: var(--text-main); flex: 1; }
        .btn-secondary:hover { background: #30363d; }
        .btn-danger {
            background: transparent; color: var(--danger);
            border: 1px solid var(--border); padding: 4px 8px; font-size: 0.8rem;
        }

        /* RULE LIST */
        .rule-list {
            margin-top: 20px;
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }
        .rule-item {
            background: var(--input-bg);
            padding: 10px 15px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
        }
        .rule-item:last-child { border-bottom: none; }

        /* OUTPUT AREA */
        textarea {
            width: 100%;
            height: 250px;
            background: #0d1117;
            color: #79c0ff;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            resize: vertical;
            white-space: pre;
            box-sizing: border-box;
        }

        .footer {
            text-align: center;
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        .footer a { color: var(--highlight); text-decoration: none; }

        .counter-pill {
            background: rgba(255,255,255,0.05);
            padding: 4px 12px;
            border-radius: 20px;
            border: 1px solid var(--border);
            font-size: 0.75rem;
        }
    </style>
</head>
<body>

<div class="container">
    
    <div class="card">
        <div class="header">
            <h1>UFW Script Master</h1>
            <span class="badge">v2.0</span>
        </div>

        <label>Select Rule Type:</label>
        <div class="mode-switcher">
            <div class="mode-btn active" onclick="setMode('port')" id="btn-port">Port (Global)</div>
            <div class="mode-btn" onclick="setMode('ip')" id="btn-ip">IP Address (Global)</div>
            <div class="mode-btn" onclick="setMode('complex')" id="btn-complex">IP to Specific Port</div>
        </div>

        <div class="grid-form">
            <div>
                <label>Action</label>
                <select id="action">
                    <option value="allow">Allow (Open)</option>
                    <option value="deny">Deny (Block)</option>
                    <option value="limit">Limit (Brute Force Protect)</option>
                </select>
            </div>

            <div id="field-proto">
                <label>Protocol</label>
                <select id="protocol">
                    <option value="">TCP & UDP (Both)</option>
                    <option value="/tcp">TCP Only</option>
                    <option value="/udp">UDP Only</option>
                </select>
            </div>

            <div class="full-width hidden" id="field-ip">
                <label>IP Address or Subnet (e.g. 192.168.1.5 or 10.0.0.0/24)</label>
                <input type="text" id="ip_input" placeholder="192.168.1.5">
            </div>

            <div class="full-width" id="field-port">
                <label id="lbl-port">Port Number or Service (e.g. 80, 443, ssh)</label>
                <input type="text" id="port_input" placeholder="22">
            </div>

            <div class="full-width">
                <label>Comment (Optional)</label>
                <input type="text" id="comment" placeholder="e.g. Home Office, Web Server">
            </div>
        </div>

        <div class="btn-group">
            <button class="btn-primary" onclick="addRule()">+ Add Rule to Script</button>
            <button class="btn-secondary" onclick="copySingle()">Copy Single Cmd</button>
        </div>

        <div id="ruleListContainer" style="display:none;">
            <h4 style="margin: 20px 0 10px 0; color:var(--text-muted); font-size:0.9rem;">Script Staging Area</h4>
            <div class="rule-list" id="ruleList"></div>
        </div>
    </div>

    <div class="card output-area">
        <div class="header">
            <h2 style="font-size:1.1rem; margin:0;">Generated Bash Script</h2>
            <button class="btn-secondary" style="font-size:0.8rem; padding: 5px 10px;" onclick="copyScript()">Copy Script</button>
        </div>
        <textarea id="finalOutput" readonly>#!/bin/bash
# UFW Firewall Setup Script
# Generated by UFW Master v2

# 1. Reset UFW (Optional safety)
sudo ufw --force reset

# 2. Set Defaults (Secure)
sudo ufw default deny incoming
sudo ufw default allow outgoing

# --- USER RULES ---

# (Add rules above to populate this area)

# ------------------

# 3. Enable Firewall
sudo ufw --force enable
sudo ufw status verbose
</textarea>
    </div>

    <div class="footer">
        <div class="counter-pill">
            <span>Visitor Count:</span>
            <strong style="color:white;">(Local)</strong>
        </div>
        <div>
            Developed by <a href="https://github.com/Sohag1192" target="_blank">Sohag1192</a>
        </div>
    </div>

</div>

<script>
    let rules = [];
    let currentMode = 'port';

    function setMode(mode) {
        currentMode = mode;
        
        // UI Tabs
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-' + mode).classList.add('active');

        // Field Visibility
        const fIP = document.getElementById('field-ip');
        const fPort = document.getElementById('field-port');
        const fProto = document.getElementById('field-proto');

        if (mode === 'port') {
            fIP.classList.add('hidden');
            fPort.classList.remove('hidden');
            fProto.classList.remove('hidden');
            document.getElementById('lbl-port').innerText = "Port Number or Service (e.g. 80, 443)";
        } 
        else if (mode === 'ip') {
            fIP.classList.remove('hidden');
            fPort.classList.add('hidden');
            fProto.classList.add('hidden');
        } 
        else if (mode === 'complex') {
            fIP.classList.remove('hidden');
            fPort.classList.remove('hidden');
            fProto.classList.remove('hidden');
            document.getElementById('lbl-port').innerText = "Target Port (The port they can access)";
        }
    }

    function addRule() {
        const action = document.getElementById('action').value;
        const comment = document.getElementById('comment').value.trim();
        let cmd = "";

        if (currentMode === 'port') {
            const p = document.getElementById('port_input').value.trim();
            const proto = document.getElementById('protocol').value;
            if(!p) return alert("Enter a port");
            cmd = `ufw ${action} ${p}${proto}`;
        }
        else if (currentMode === 'ip') {
            const ip = document.getElementById('ip_input').value.trim();
            if(!ip) return alert("Enter an IP");
            cmd = `ufw ${action} from ${ip}`;
        }
        else if (currentMode === 'complex') {
            const ip = document.getElementById('ip_input').value.trim();
            const p = document.getElementById('port_input').value.trim();
            const proto = document.getElementById('protocol').value; // Usually ignored in "to any port" syntax unless specific, but UFW handles it roughly.
            // Correct syntax: ufw allow from <IP> to any port <PORT> proto <TCP>
            if(!ip || !p) return alert("Enter IP and Port");
            
            cmd = `ufw ${action} from ${ip} to any port ${p}`;
            if(proto === "/tcp") cmd += " proto tcp";
            if(proto === "/udp") cmd += " proto udp";
        }

        if (comment) cmd += ` comment '${comment}'`;

        rules.push({ cmd: cmd });
        updateUI();
    }

    function removeRule(index) {
        rules.splice(index, 1);
        updateUI();
    }

    function updateUI() {
        const list = document.getElementById('ruleList');
        const container = document.getElementById('ruleListContainer');
        
        if (rules.length > 0) {
            container.style.display = 'block';
            list.innerHTML = "";
            rules.forEach((r, i) => {
                list.innerHTML += `
                    <div class="rule-item">
                        <span>sudo ${r.cmd}</span>
                        <button class="btn-danger" onclick="removeRule(${i})">X</button>
                    </div>`;
            });
        } else {
            container.style.display = 'none';
        }
        generateScript();
    }

    function generateScript() {
        const head = `#!/bin/bash\n# UFW Firewall Setup Script\n# Generated by UFW Master v2\n\n# 1. Reset UFW\nsudo ufw --force reset\n\n# 2. Set Defaults\nsudo ufw default deny incoming\nsudo ufw default allow outgoing\n\n# --- USER RULES --- \n`;
        const foot = `\n# ------------------\n\n# 3. Enable Firewall\nsudo ufw --force enable\nsudo ufw status verbose`;
        
        let body = rules.map(r => `sudo ${r.cmd}`).join('\n');
        if (!body) body = "# (Add rules above)";
        
        document.getElementById('finalOutput').value = head + body + foot;
    }

    function copySingle() {
        // Just triggers addRule logic but doesn't add to list, just alerts/copies
        // For simplicity, let's just use the logic from addRule partially or 
        // alert the user to use the "Add Rule" button + Copy Script for better workflow.
        // Or implement a quick helper:
        alert("Use the 'Add Rule' button to generate the command, then copy the script below!");
    }

    function copyScript() {
        const txt = document.getElementById('finalOutput').value;
        navigator.clipboard.writeText(txt).then(() => {
            alert("Script copied to clipboard!");
        });
    }

    // Init
    setMode('port');
</script>

</body>
</html>